# Compound Measures

Measures whose expressions reference other measures by name.

## Overview

Compound measures define metrics using other measures (and optionally dimensions) in their expression. The expression is evaluated at **query time**, with each referenced measure or dimension replaced by its resolved SQL.

## Definition

Use square brackets to reference other fields by name in the expression:

```yaml
- type: measure
  name: Profit Margin
  data_type: decimal
  expression:
    sql: ([Total Revenue] - [Total Cost]) / [Total Revenue]
```

Here `Total Revenue` and `Total Cost` must be measures (or dimensions) defined in the same table or reachable via the model.

## When to Use

- Ratios of measures: margin, conversion, per-unit metrics
- Differences or sums of measures: profit, variance
- Any metric that is a formula over other measures

## Runtime Resolution

:::info Compound measures and expressions

Compound measures that use expressions are **resolved at query time**. The expression SQL is evaluated when the query runs: each referenced measure or dimension is replaced by its resolved SQL from the underlying tables or from other compound measures.

This allows flexible, formula-like measures. Ensure that every referenced field exists and is reachable in the context of the query; otherwise resolution can fail at query time.
:::

## Example

```yaml
fields:
  - type: measure
    name: Total Revenue
    data_type: decimal
    expression:
      sql: sum(amount)

  - type: measure
    name: Total Cost
    data_type: decimal
    expression:
      sql: sum(cost)

  - type: measure
    name: Profit
    data_type: decimal
    expression:
      sql: [Total Revenue] - [Total Cost]

  - type: measure
    name: Profit Margin
    data_type: decimal
    formatter: percent
    expression:
      sql: [Profit] / [Total Revenue]
```

## Compound Measures in Expressions

When a compound measure is used inside another expression (e.g. in a [temporal decorator](/docs/advanced/decorators/temporal) or another compound measure), it is also resolved at query time. The dependency chain is evaluated when the query is built, so the order of definition in YAML does not need to follow the dependency order.

## Best Practices

1. **Use clear, unique names** — Referenced measures must be found by name.
2. **Avoid circular references** — A → B → A is invalid.
3. **Check reachability** — All referenced fields must be in the same table or joinable in the query.
4. **Prefer simpler expressions** — Complex nests can make debugging harder.

## Next Steps

- [Measures](/docs/semantic-model/fields/measures)
- [Expressions](/docs/semantic-model/expressions/sql)
- [Temporal decorators](/docs/advanced/decorators/temporal) — Compound measures in time-based calculations
