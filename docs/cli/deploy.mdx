# strata deploy

Deploy project to Strata server.

## Synopsis

```bash
strata deploy [OPTIONS]
strata deploy status [OPTIONS]
```

## Description

Deploys your semantic model to a Strata server. The process includes:
1. Pre-deployment audits (unless skipped)
2. Git status validation
3. Archive creation (incremental or full)
4. Upload to server
5. Deployment monitoring

## Options

### -e, --environment ENV

Deploy to specific environment.

```bash
strata deploy --environment production
```

Environments configured in `project.yml`:
```yaml
environments:
  production:
    server: https://strata.example.com
    api_key: prod_key
  staging:
    server: https://staging.strata.example.com
    api_key: staging_key
```

### --skip-audit

Skip pre-deployment audit checks.

```bash
strata deploy --skip-audit
```

**Not recommended** - Audits catch issues before deployment.

### --yes, -y

Skip confirmation prompts. Required for CI/CD.

```bash
strata deploy --yes
```

### -f, --force

Force deployment even if no files changed.

```bash
strata deploy --force
```

## Deployment Process

### 1. Pre-Deployment Checks

Runs automatically (unless `--skip-audit`):
- YAML syntax validation
- Model structure validation
- Datasource connection tests

### 2. Git Status Validation

Checks:
- Working directory is clean
- Current branch matches production branch (if configured)

### 3. Archive Creation

Creates archive with:
- Model files (`models/**/*.yml`)
- Migration files (`migrations/*.yml`)
- Test files (`tests/*.yml`)
- Configuration files

**Incremental:** Only changed files (if previous deployment exists)
**Full:** All files (first deployment)

### 4. Upload and Processing

Server processes:
- Validates files
- Builds semantic model
- Generates universe paths
- Runs tests (if defined)

### 5. Monitoring

CLI monitors:
- Deployment stages (validating, building, testing, finished)
- Test results
- Success/failure status

## Status Command

Check deployment status:

```bash
strata deploy status
```

**Options:**
- `-e, --environment ENV` - Check specific environment

**Shows:**
- Deployment ID
- Current status (queued, pending, succeeded, failed)
- Current stage
- Test results (if available)

## Deployment Stages

1. **Queued** - Waiting to start
2. **Validating** - Checking YAML and structure
3. **Building** - Creating semantic model
4. **Testing** - Running test files
5. **Finished** - Deployment complete

## Examples

### Basic Deployment

```bash
strata deploy
```

### Production Deployment

```bash
strata deploy --environment production
```

### CI/CD Deployment

```bash
strata deploy --yes
```

### Force Deployment

```bash
strata deploy --force
```

### Check Status

```bash
strata deploy status
```

## Configuration

### project.yml

```yaml
name: My Project
server: https://strata.example.com
production_branch: main
project_id: 123  # Auto-populated after first deployment
```

### .strata

```yaml
api_key: your_api_key_here
```

## Troubleshooting

### Deployment Fails

**Check:**
- YAML syntax errors
- Model validation errors
- Datasource connections
- Server URL and API key

**Solution:**
```bash
strata audit  # Run audits to identify issues
```

### Tests Fail

**Check:**
- Test assertions match generated SQL
- Field names are correct

**Solution:**
- Review test output
- Update test expectations

## Next Steps

- [deployment](/docs/guides/deployment)
- [ci-cd](/docs/guides/ci-cd)
- [testing](/docs/guides/testing)
